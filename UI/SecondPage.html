<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Carotid Calcium Scanner</title>
    <link rel="stylesheet" href="styleSecond.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <!--This is a page I used to get the icons upload and info in the second page of the UI-->
    <script src="https://kit.fontawesome.com/e3accbbb35.js" crossorigin="anonymous"></script>
    <!-- Here is the connection between the js and html files-->
    <script src="https://unpkg.com/cornerstone-core/dist/cornerstone.min.js"></script>
    <script src="https://unpkg.com/cornerstone-wado-image-loader"></script>
    <script src="https://unpkg.com/dicom-parser"></script>
    <script src="https://unpkg.com/cornerstone-math"></script>
    <script src="https://unpkg.com/cornerstone-tools"></script>
    <script src="https://unpkg.com/hammerjs"></script>
    <script src="../tools.js"></script>
    <script>

        cornerstoneWADOImageLoader.external.cornerstone = cornerstone;
        cornerstoneWADOImageLoader.external.dicomParser = dicomParser;
        cornerstoneTools.external.Hammer = Hammer;
        cornerstoneTools.external.cornerstone = cornerstone;
        cornerstoneTools.external.cornerstoneMath = cornerstoneMath;

        function onDragOver(event) {

            // stop browser processing right away
            event.stopPropagation();
            event.preventDefault();

        };

        function onDrop(event) {

            // stop browser processing right away
            event.stopPropagation();
            event.preventDefault();

            imageIds = [];

            for (var i = 0; i < event.dataTransfer.files.length; i++) {

                var file = event.dataTransfer.files[i];
                imageIds.push(cornerstoneWADOImageLoader.wadouri.fileManager.add(file));

            }

            cornerstone.loadImage(imageIds[0]).then(function (image) {

                console.log('Loaded', image);

                cornerstoneTools.init();

                var viewer = document.getElementById('viewer');

                cornerstone.enable(viewer);
                cornerstone.displayImage(viewer, image);


                var stack = { currentImageIdIndex: 0, imageIds: imageIds };
                cornerstoneTools.addStackStateManager(viewer, ["stack"]);
                cornerstoneTools.addToolState(viewer, "stack", stack);

                cornerstoneTools.addTool(cornerstoneTools.StackScrollMouseWheelTool);
                cornerstoneTools.addTool(ThresholdsBrushTool);
                cornerstoneTools.addTool(cornerstoneTools.ZoomTool);
                cornerstoneTools.addTool(cornerstoneTools.FreehandRoiTool);

                // Brush is right click, zoom is left click.
                cornerstoneTools.setToolActive('ThresholdsBrush', { mouseButtonMask: 1 });
                cornerstoneTools.setToolActive('StackScrollMouseWheel', {});
                cornerstoneTools.setToolActive('Zoom', { mouseButtonMask: 2 });
                // This tool allows you to get the area of a circled area using a brush.
                // cornerstoneTools.setToolActive("FreehandRoi", { mouseButtonMask: 1});
            });

        };

        window.onload = function () {

            document.body.addEventListener('dragover', onDragOver);
            document.body.addEventListener('drop', onDrop);
        };

        window.onkeyup = function (event) {

            if (event.key == '-') {
                cornerstoneTools.store.state.tools[1].decreaseBrushSize();
            } else if (event.key == '=') {
                cornerstoneTools.store.state.tools[1].increaseBrushSize();
            } else if (event.key == '1') {
                cornerstoneTools.getModule('segmentation').setters.incrementActiveSegmentIndex(viewer);
            } else if (event.key == '2') {
                cornerstoneTools.getModule('segmentation').setters.decrementActiveSegmentIndex(viewer);
            }
        };
        function disable() {
            document.getElementById("Color").disabled = true;
        }
        function enable() {
            document.getElementById("Color").disabled = false;
        }
    </script>
</head>
    <body>
        <!--The looks:-->
        <div class="back-ground">
            <!--Logo-->
            <img src="imag/logo1.png" class="logo" />
            <!--this is the info button on the top right corner-->
            <a href="info.html">
                <button class="info">
                    <i class="fa fa-info"></i>
                </button>
            </a>
            <!--This created the blue line on top of the page-->
            <hr />
            <p1>Brush</p1>
            <button class="brush" onclick="enable()">
                <i class="fa-solid fa-paintbrush"></i>
            </button>
            <p4>Brush Size</p4>
            <button class="bplus">
                <i class="fa-solid fa-plus"></i>
            </button>
            <button class="bminus">
                <i class="fa-solid fa-minus"></i>
            </button>
            <p5>Brush Color</p5>
            <select id="Color">
                <option>Red</option>
                <option>Green</option>
                <option>Purple</option>
                <option>Blue</option>
                <option>Pink</option>
            </select>
            <p2>Zoom</p2>
            <button class="zoom" onclick="disable()">
                <i class="fa-solid fa-magnifying-glass"></i>
            </button>
            
            <p3>Reset</p3>
            <button class="reset" onclick="disable()">
                <i class="fa-solid fa-arrow-rotate-left"></i>
            </button>
            <p6>Drag & Drop</p6>
            <!--viewer for drag and drop-->>
            <div class="viewer">
                <p id="viewer"></p>
            </div>
        </div>
    </body>

</html>
